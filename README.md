# Vention MachineCloud test by @jadiaheno

## Prerequisites

- Install [docker (with compose)](https://www.docker.com/get-started/)

## How to launch

```
git clone https://github.com/jadiaheno/vention-machine-cloud-test.git
cd vention-machine-cloud-test
docker compose up -d
```

## What's in it?

This is an album store. It shows you a list of albums that you can rate from 1 to 5, and can add to your cart.
The album list was generated by leveraging the [spotify provider](https://next-auth.js.org/providers/spotify) from NextAuth.js, then inserting the albums from my liked songs in the database. You have here a snapshot of my musical taste!

## How did it go?

#### T3

First of all, there is a [bug](https://github.com/nextauthjs/next-auth/issues/8283) in the drizzle-adapter shipping with the latest version of the T3. Luckily for me, it was fixed in a more recent version with no incompatibility.

#### Drizzle

It was my first experience with the drizzle ORM, and will not be the last. It supports joins and relations out of the box (unlike prisma). The syntax and helpers enabled me to write mid-complex queries (upserts, increments, etc...).
I'm passing generated migrations sql files directly in the migration folder of the postgres database instead of migrating with the API.

#### tRPC

tRPC provides a fully-typed API client, and useful functions server-side (eg: input sanitization with zod).

#### NextAuth

I implemented guest sessions which is not supported by next-auth. I customized heavily the authOptions to be able to create guest sessions without JWT. In fact, the [Credential Provider](https://next-auth.js.org/configuration/providers/credentials) from NextAuth does not support database session management as a strategy, only JWT; but we found a work-around.

#### Misc

On my machine, i used [bun](https://bun.sh/) as bundler, but their docker image has an issue with tRPC. I reverted to npm for the docker image.
Next 14 only works with Node >= v18.17.0.

## What was built

- [x] An application using React that will display a list of items that you can add to your cart
- [x] When you add an item to your cart it should be represented in the UI
- [x] You should be able to remove products from the cart
- [x] You must add the ability to rate products with a score from (1 to 5)
- [x] Provide instructions in the README to launch the application

## Bonus points

- [x] **Use TypeScript**
- [x] Implement a backend and persist the state in a database
- [x] Have a single command to launch the whole application
- [x] Use the open-source project [T3 stack](https://create.t3.gg/) as a template for your application
